@page "/fiche/{id:guid}"
@inject PdfService PdfService
@inject NavigationManager Navigation
@using GestionNotes.Blazor.Services
@inject IJSRuntime JSRuntime

<PageTitle>Fiche de Préinscription</PageTitle>

<div>
    <iframe src="@pdfUrl" width="100%" height="600px"></iframe>
    <button @onclick="DownloadPdf">Télécharger le PDF</button>
</div>

@code {
    [Parameter]
    public Guid Id { get; set; }

    private string pdfUrl;

    protected override async Task OnInitializedAsync()
    {
        var pdfBytes = await PdfService.GetPreinscriptionPdfAsync(Id);
        var base64Pdf = Convert.ToBase64String(pdfBytes);
        pdfUrl = $"data:application/pdf;base64,{base64Pdf}";
    }

    private async Task DownloadPdf()
    {
        var pdfDownloadUrl = $"/api/CreatePreinscription/{Id}/pdf";
        await JSRuntime.InvokeVoidAsync("downloadPdf", pdfDownloadUrl);
    }
}
